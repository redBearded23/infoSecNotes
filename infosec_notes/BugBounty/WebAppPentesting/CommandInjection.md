# Command Injection

## Basics

- Abuse of an application's behaviour to execute commands on the operating system, using the same privileges that the application on a device is running with
- also known as a "Remote Code Execution" (RCE) because an attacker can trick the application into executing a series of payloads that they provide, without direct access to the machine itself
  - webserver will process this code and execute it under the privileges and access controls of the user who is running that application.
- also often known as “Remote Code Execution” (RCE) because of the ability to remotely execute code within an application
- these vulnerabilities are often the most lucrative to an attacker because it means that the attacker can directly interact with the vulnerable system. For example, an attacker may read system or user files, data, and things of that nature.
  - For example, being able to abuse an application to perform the command `whoami` to list what user account the application is running will be an example of command injection.
- Applications that use user input to populate system commands with data can often be combined in unintended behaviour. **For example, the shell operators `;`, `&` and `&&` will combine two (or more) system commands and execute them both**
- Command Injection can be detected in mostly one of two ways:
  - **Blind command injection**
    - no direct output from the application when testing payloads. You will have to investigate the behaviours of the application to determine whether or not your payload was successful
    - **Detection:**
      - need to use payloads that will cause some time delay
        - For example, the `ping` and `sleep` commands are significant payloads to test with. Using `ping` as an example, the application will hang for *x* seconds in relation to how many *pings* you have specified.
        - The `curl` command is a great way to test for command injection
          - this is because you are able to use `curl` to deliver data to and from an application in your payload
          - Example: a simple curl payload to an application is possible for command injection:
            `curl http://vulnerable.app/process.php%3Fsearch%3DThe%20Beatles%3B%20whoami`
      - Forcing some output
        - can be done by using redirection operators such as `>` to write output to a file and then access the newly created file with i.e. `cat`
  - **Verbose command injection**
    - direct feedback from the application once you have tested a payload. For example, running the `whoami` command to see what user the application is running under. The web application will output the username on the page directly.
- **How To Prevent Command Injection:**
  - minimal use of potentially dangerous functions or libraries in a programming language --> these are especially functions that interact with the operating system and/or its ressources via shell
  - Sanitizing Input
    - filtering input without relying on a user’s input
    - process of specifying the formats or types of data that a user can submit
- How to Bypass Prevention:
  - Applications will employ numerous techniques in filtering and sanitising data that is taken from a  user's input
  - filters will restrict you to specific payloads
  - however, we can abuse the logic behind an application to bypass these filters. For example, an application may strip out quotation marks; we can instead use the hexadecimal value of this to achieve the same result
    - When executed, although the data given will be in a different format than what is expected, it can still be interpreted and will have the same result.

## Linux Command Injection Payloads

- `whoami` --> See what user the application is running under
- `ls` --> List the contents of the current directory. You may be able to find files such as configuration files, environment files (tokens and application keys), and many more valuable things.
- `ping` --> This command will invoke the application to hang. This will be useful in testing an application for blind command injection.
- `sleep` --> This is another useful payload in testing an application for blind command injection, where the machine does not have `ping` installed.
- `nc` --> Netcat can be used to spawn a reverse shell onto the vulnerable application. You can use this foothold to navigate around the target machine for other services, files, or potential means of escalating privileges.

## Windows Command Injection Payloads

- `whoami` --> See what user the application is running under.
- `dir` --> List the contents of the current directory. You may be able to find files such as configuration files, environment files (tokens and application keys), and many more valuable things.
- `ping` --> This command will invoke the application to hang. This will be useful in testing an application for blind command injection.
- `timeout` --> This command will also invoke the application to hang. It is also useful for testing an application for blind command injection if the `ping` command is not installed.
